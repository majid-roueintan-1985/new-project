@model IEnumerable<Bnpp.DataLayer.Entities.DamageabilityReport>
@{
    ViewData["Title"] = "OrderByAscendingAllowableCUF";
    Layout = null;
}

<br />

@{
    int rowCount = 1;
}

<table id="myTable" @*cellpadding="3" cellspacing="0"*@ aria-describedby="example_info" class="display dataTable">
    <br />

    <div id="myTable_filter" class="dataTables_filter">
        <label style="margin:10px">
            Search Date: <input name="searchDate" id="searchDate" onchange="GetDate();" style="direction: ltr; text-align: left;">
        </label>
        <label>
            Show: @*<input id="ShowEntries" onchange="ShowSelectedRecords();" style="direction: ltr; text-align: left;">*@
            <select onchange="ShowSelectedRecords();" name="lenghtOfTable" aria-controls="myTable" class=""><option value="98">All</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="75">75</option></select> AKZ

        </label>
        <label style="margin:10px">
            Sort By:
            <select onchange="SortByByActionperiodofequipment();" name="SortBySelectedColumns" aria-controls="myTable" class="">
                <option value="9">Allowable CUF</option>

                <option value="1"> Date</option>
                <option value="2">Location of the checkpoint</option>
                <option value="3">Action period of equipment (years)</option>
                <option value="4">Life time of equipment in design (years)   </option>
                <option value="5">Life time of equipment per RALDS (years)</option>
                <option value="6">Damageability per coiled cycles</option>
                <option value="7">Damageability per uncoiled cycles</option>
                <option value="8">Total damageability of equipment</option>

                <option value="10">Allowable Remaining Life Time</option>
                <option value="11">Changing Ratio</option>
                <option value="12">Allowable Changing Ratio</option>
                <option value="13">File Date</option>
            </select>
        </label>

        <label style="margin:10px">
            Order By:
            <select onchange="OrderByAscendingDate();" name="SortByAscendingSelectedColumns" aria-controls="myTable" class="">
               
                <option value="18">Ascending</option>
                <option value="17"> Descending</option>
            </select>
        </label>
        <label style="margin:10px">
            Show:
            <select onchange="ShowRecords();" name="lenghtOfAkz" aria-controls="myTable" class="">
                <option value="0">All</option>
                <option value="5">5</option>
                <option value="15">15</option>
                <option value="25">25</option>
                <option value="45">45</option>
                <option value="75">75</option>
            </select> records
        </label>
    </div>

    <br />
    <thead>
        <tr role="row">
            <th data-orderable="false">
                <input type="checkbox" id="checkAll" />
            </th>
            <th data-orderable="false">

            </th>
            <th>
                <b>AKZ</b>
            </th>
            <th data-orderable="false">
                <b>Date</b>
            </th>
            <th data-orderable="false">
                <b>Location of the checkpoint</b>
            </th>
            <th data-orderable="false">
                <b>Action period of equipment (years)</b>
            </th>
            <th data-orderable="false">
                <b>Life time of equipment in design (years)</b>
            </th>
            <th data-orderable="false">
                <b>
                    Life time of equipment per RALDS (years)
                </b>
            </th>
            <th data-orderable="false">
                <b>
                    Damageability per coiled cycles
                </b>
            </th>
            <th data-orderable="false">
                <b>
                    Damageability per uncoiled cycles
                </b>
            </th>
            <th data-orderable="false">
                <b>
                    Total damageability of equipment
                </b>
            </th>
            <th data-orderable="false">
                <b>
                    Allowable CUF
                </b>
            </th>
            <th data-orderable="false">
                <b>
                    Allowable Remaining Life Time
                </b>
            </th>
            <th data-orderable="false">
                <b>
                    Changing Ratio
                </b>
            </th>
            <th data-orderable="false">
                <b>
                    Allowable Changing Ratio
                </b>
            </th>
            <th data-orderable="false">
                <b>
                    File Date
                </b>
            </th>
            <th data-orderable="false">
                <b>

                </b>
            </th>
        </tr>
    </thead>
    <tbody>

        @foreach (var item in Model)
        {
            <tr role="row">
                <td>
                    <input type="checkbox" class="checkBox" value="@item.ID" />
                </td>
                <td>
                    @rowCount
                </td>
                <td>
                    @item.Akz
                </td>
                <td>
                    @item.ReportDate.ToString("yyyy/MM/dd")
                </td>
                <td>
                    @item.Locationofthecheckpoint
                </td>
                <td>
                    @item.Actionperiodofequipment
                </td>
                <td>
                    @item.Lifetimeofequipmentindesign
                </td>

                @if ((Convert.ToDecimal(item.LifetimeofequipmentperRALDS)) <= (Convert.ToDecimal(item.AllowableLifeTime)))
                {
                    <td style="background-color:red;">
                        @item.LifetimeofequipmentperRALDS
                    </td>
                }
                else
                {
                    <td>
                        @item.LifetimeofequipmentperRALDS
                    </td>
                }


                <td>
                    @item.Damageabilitypercoiledcycles
                </td>
                <td>
                    @item.Damageabilityperuncoiledcycles
                </td>

                @if ((Convert.ToDecimal(item.Totaldamageabilityofequipment)) >= (Convert.ToDecimal(item.AllowableCUF)))
                {
                    <td style="background-color:red;">
                        @item.Totaldamageabilityofequipment
                    </td>
                }
                else
                {
                    <td>
                        @item.Totaldamageabilityofequipment
                    </td>
                }

                <td>
                    @item.AllowableCUF
                </td>

                <td>
                    @item.AllowableLifeTime
                </td>

                @if ((Convert.ToDecimal(item.AllowableChangingRatio)) <= (Convert.ToDecimal(item.ChangingRatio)))
                {
                    <td style="background-color:red;">
                        @item.ChangingRatio
                    </td>
                }
                else
                {
                    <td>
                        @item.ChangingRatio
                    </td>
                }

                <td>
                    @item.AllowableChangingRatio
                </td>

                <td>
                    @item.CreateDate.ToString("yyyy/MM/dd")
                </td>
                <td>
                    <a class="btn-edit-equip" href="/Import/EditDamageabilityReport/@item.ID">
                        Edit
                    </a>
                </td>
            </tr>
            rowCount++;
        }

    </tbody>
</table>
<br>


<link href="/css/kendo.common.min.css" rel="stylesheet" />
<link href="/css/kendo.default.min.css" rel="stylesheet" />
<link href="/css/jquery.dataTables.min.css" rel="stylesheet" />

<script src="/js/jquery.min.js"></script>
<script src="/js/kendo.all.min.js"></script>
<script src="~/js/jquery.validate.min.js"></script>
<script src="~/js/jquery.validate.unobtrusive.min.js"></script>

<script>
    // create DatePicker from input HTML element
    $("#reportDate").kendoDatePicker();
    $("#searchDate").kendoDatePicker();
    $("#searchfileDate").kendoDatePicker(
        {
            format: "yyyy/MM/dd"
        });

    $("#schDate").kendoDatePicker(
        {
            format: "yyyy/MM/dd"
        });


</script>

<script src="/js/jquery.min.js"></script>

<script src="/js/datatables.min.js"></script>

<script>
    $(document).ready(function () {
        $("#mySecondTable").DataTable();
    });
</script>


<script>

    function Edit(id) {
        $("#newPage").load("/Import/EditDamageabilityReport/" + id);
    }

    //function GetGroupByDate() {
    //    $("#GroupBy").load("/Import/GroupByDatessss/");
    //}



    function refreshPage() {
        // Your delay in milliseconds
        var delay = 3000;
        setTimeout(function () { window.location = "/SACOR-446"; }, delay);
    }

    function ShowAllRecords() {
        window.location = "/SACOR-446";
    }

    $('input:checkbox.checkBox').change(function () {
        var selectedIDs = new Array();
        $('input:checkbox.checkBox').each(function () {
            if ($(this).prop('checked')) {
                selectedIDs.push($(this).val());
            }
        });

        $('#exportSelectedData').val(selectedIDs);


        //alert(selectedIDs);
    });




    $("#checkAll").click(function () {
        $(".checkBox").prop('checked',
            $(this).prop('checked'));
    });

    $("#delete").click(function () {
        var selectedIDs = new Array();
        $('input:checkbox.checkBox').each(function () {
            if ($(this).prop('checked')) {
                selectedIDs.push($(this).val());
            }
        });
        var result = confirm("are you sure you want to delete?");
        if (result) {
            $.ajax({
                type: "POST",
                url: "/Import/DeleteDamageabilityReport",
                data: { "damagingId": selectedIDs },
                success: function (response) {
                    window.location.href = "/SACOR-446";
                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });
        }
    });


    function GetDate() {
        var date = $('#searchDate').val();

        $('input[type=search]').val(date);

        $('input[type=search]').focus();

        //$('searchDate').on('change', function () {
        //table.draw();


        $('#searchDate').val("");

    };

    function GetSearchhDate() {
        var date = $('#searchfileDate').val();

        $('#schfileDate').val(date);

        $('#searchfileDate').val("");

    };

    function GetSearchfromDate() {
        var date = $('#schDate').val();

        $('#srchDate').val(date);

        $('#schDate').val("");

    };

    //<------ Sort By Selected Items ----->

    function SortByByActionperiodofequipment() {

        var selectInput = $('select[name=SortBySelectedColumns] option').filter(':selected').val();

        if (selectInput == 1) {
            window.location.href = "/SACOR-446";
        }

        if (selectInput == 2) {
            $("#newColumnSort").load("/Import/SortByByLocationofthecheckpoint/");
        }

        if (selectInput == 3) {
            $("#newColumnSort").load("/Import/SortByByActionperiodofequipment/");
        }

        if (selectInput == 4) {
            $("#newColumnSort").load("/Import/SortByByLifetimeofequipmentindesign/");
        }

        if (selectInput == 5) {
            $("#newColumnSort").load("/Import/SortByByLifetimeofequipmentperRALDS/");
        }

        if (selectInput == 6) {
            $("#newColumnSort").load("/Import/SortByByDamageabilitypercoiledcycles/");
        }

        if (selectInput == 7) {
            $("#newColumnSort").load("/Import/SortByByDamageabilityperuncoiledcycles/");
        }

        if (selectInput == 8) {
            $("#newColumnSort").load("/Import/SortByByTotaldamageabilityofequipment/");
        }

        if (selectInput == 9) {
            $("#newColumnSort").load("/Import/SortByByAllowableCUF/");
        }

        if (selectInput == 10) {
            $("#newColumnSort").load("/Import/SortByByAllowableRemainingLifeTime/");
        }

        if (selectInput == 11) {
            $("#newColumnSort").load("/Import/SortByByChangingRatio/");
        }

        if (selectInput == 12) {
            $("#newColumnSort").load("/Import/SortByByAllowableChangingRatio/");
        }

        if (selectInput == 13) {
            $("#newColumnSort").load("/Import/SortByByByFileDate/");
        }
    }

    //<------End Sort By Selected Items ----->
    //<----- ----->

    function ShowRecords() {

        var selectInput = $('select[name=lenghtOfAkz] option').filter(':selected').val();

        var steps = $(".group").eq(1).attr('id');

        if (selectInput > +steps) {
            alert("The data you are looking for was not found. Please choose another item !");
        }

        if (selectInput == 0)
            window.location.href = "/SACOR-446";

        if (selectInput == 5) {

            $("#newColumnSort").load("/Import/FiveList/");

        }

        if (selectInput == 15) {

            $("#newColumnSort").load("/Import/FifteenList/");

        }

        if (selectInput == 25) {

            $("#newColumnSort").load("/Import/TwentyFiveList/");

        }

        if (selectInput == 45) {

            $("#newColumnSort").load("/Import/FortyFiveList/");

        }


        if (selectInput == 75) {

            $("#newColumnSort").load("/Import/SeventyFiveList/");

        }

    }

    //<------ ----->
    //<------ Sort By Selected Items ----->

    function OrderByAscendingDate() {

        var selectInput = $('select[name=SortByAscendingSelectedColumns] option').filter(':selected').val();

        if (selectInput == 18) {
            $("#newColumnSort").load("/Import/OrderByAscendingAllowableCUF/");
        }

        if (selectInput == 17) {
            $("#newColumnSort").load("/Import/SortByByAllowableCUF/");
        }
    }

    //<------End Sort By Ascending Selected Items ----->

    //<------ Show Selected Items ----->

    function ShowSelectedRecords() {

        var selectInput = $('select[name=lenghtOfTable] option').filter(':selected').val();
        //var numberOfShownRecords = $("#ShowEntries").val();

        var steps = $(".group").eq(1).attr('id');
        var end = $(".group").eq(97).attr('id');

        for (i = 0; i <= end; i += +steps) {
            $("#" + i).hide();

        }

        //var start = numberOfShownRecords * steps;
        var start = selectInput * steps;




        for (i = 0; i < start; i += +steps) {
            $("#" + i).show();

        }

        //for (i = start; i <= end; i += +steps) {
        //    $("#" + i).hide();

        //}

    }

    //<------End Show Selected Items ----->

    $(document).ready(function () {
        $('tbody tr[role="row"]').hide();
    });

    //Group By Akz


    //group
    $(document).ready(function () {
        var groupColumn = 2;
        var table = $('#myTable').DataTable({


            columnDefs: [{ visible: false, targets: groupColumn }],
            order: [[groupColumn, 'asc']],


            // hide "Showing 1 of N Entries" with the dataTables.js library
            "info": false,



            //colReorder: {
            //    order: [ 5,6]
            //},

            //"ordering": true,
            //columnDefs: [{
            //    orderable: false,
            //    targets: "no-sort"
            //}],
            //displayLength: 1000,
            paging: false,

            //lengthMenu: [
            //    [-1, 10, 25, 50,75],
            //    ['All', 10, 25, 50,75],
            //],


            drawCallback: function (settings) {
                var api = this.api();
                var rows = api.rows({ page: 'current' }).nodes();

                var last = null;

                api
                    .column(groupColumn, { page: 'current' })
                    .data()
                    .each(function (group, i) {
                        if (last !== group) {
                            $(rows)
                                .eq(i)
                                .before('<tr class="group" id="' + i + '" style="background-color: rgba(0, 0, 0, 0.15);"><td class="dt-control"></td><td colspan="16">' + group + '</td></tr>');

                            last = group;

                        }
                    });
            },
        });



        //Add parameter to class  class="group'+i+'"
        // Order by the grouping
        $('#myTable tbody').on('click', 'tr.group', function () {

            $($(this)).nextUntil(".group").filter('tr[role="row"]').toggle();

        });

    });


    $('input[type=file]').change(function () {

        $('#reportDates').attr('value', this.files[0].name);
    });



</script>

