@model IEnumerable<Bnpp.DataLayer.Entities.TransientGroups>
@{
    ViewData["Title"] = "ListGroups";
    Layout = "~/Views/Shared/_Layout1.cshtml";
}

<h2>ListGroups</h2>


<div class="inner">

    <ul>
        @foreach (var group in Model.Where(g => g.ParentId == null))
        {
            <li>
                <input onchange="changeGroup()" type="checkbox" name="selectedGroups" value="@group.GroupId" id="cat-1">
                <label for="cat-1"> @group.GroupTitle </label>
                @if (Model.Any(g => g.ParentId == group.GroupId))
                {
                    <ul>
                        @foreach (var sub in Model.Where(g => g.ParentId == group.GroupId))
                        {
                            <li>
                                <input onchange="changeGroup()" type="checkbox" name="selectedGroups" value="@sub.GroupId" id="cat-1">
                                <a onclick="Create(@group.GroupId)" @*href="/MyTransient/Create/@group.GroupId"*@>createsub</a>
                                <label for="cat-1"> @sub.GroupTitle </label>
                            </li>
                        }
                    </ul>
                }

            </li>
        }
    </ul>
</div>

<table class="table table-bordered">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.GroupTitle)
        </th>
        <th>
            زیر گروه ها
        </th>
        <th></th>
    </tr>

    @foreach (var group in Model.Where(g => g.ParentId == null))
    {
        <tr id="group_@(group.GroupId)">
            <td>
                @Html.DisplayFor(modelItem => group.GroupTitle)
            </td>
            <td>
                @if (Model.Any(g => g.ParentId == group.GroupId))
                {
                    <ul>
                        @foreach (var subGroup in Model.Where(g => g.GroupId == group.GroupId))
                        {
                            <li id="group_@(subGroup.GroupId)">
                                @subGroup.GroupTitle    <a class="text-warning" onclick="Edit(@subGroup.GroupId)">
                                    <i class="glyphicon glyphicon-edit"></i>
                                </a>
                                <a class="text-danger" onclick="Delete(@subGroup.GroupId)">
                                    <i class="glyphicon glyphicon-trash"></i>
                                </a>
                            </li>
                        }
                    </ul>
                }
            </td>
            <td>
                <a class="btn btn-primary btn-xs" onclick="Create(@group.GroupId)">
                    <i class="glyphicon glyphicon-plus"></i>
                </a>
                <a class="btn btn-warning btn-xs" onclick="Edit(@group.GroupId)">
                    <i class="glyphicon glyphicon-edit"></i>
                </a>
                <a class="btn btn-danger btn-xs" onclick="Delete(@group.GroupId)">
                    <i class="glyphicon glyphicon-trash"></i>
                </a>
            </td>
        </tr>
    }

</table>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Modal title</h4>
            </div>
            <div class="modal-body" id="myModalBody">
                ...
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
@section Scripts
    {
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <script src="/js/jquery.min.js"></script>

    <script src="/js/bootstrap.min.js"></script>

    <script src="/js/datatables.min.js"></script>



    <script>
        $(document).ready(function () {
            $("#myTable").DataTable();
        });
    </script>

    <script>

        function Create(parentId) {
            $.get("/MyTransient/Create/" + parentId,
                function (result) {
                    $("#myModal").modal();
                    $("#myModalLabel").html("Code");
                    $("#myModalBody").html(result);
                });
        }

        $("#checkAll").click(function () {
            $(".checkBox").prop('checked',
                $(this).prop('checked'));
        });

        $("#delete").click(function () {
            var selectedIDs = new Array();

            $('input:checkbox.checkBox').each(function () {
                if ($(this).prop('checked')) {
                    selectedIDs.push($(this).val());
                }
            });

            var result = confirm("are you sure you want to delete?");
            if (result) {

                $.ajax({
                    type: "POST",
                    url: "/Cables/DeleteCable",
                    data: { "cableId": selectedIDs },



                    success: function (response) {
                        window.location.href = "/Cables";
                    },
                    failure: function (response) {
                        alert(response.responseText);
                    },
                    error: function (response) {
                        alert(response.responseText);
                    }

                });
            }

        });
    </script>
}